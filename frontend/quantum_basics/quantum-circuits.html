<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Quantum Circuits - Advanced Educational Simulator</title>
    <meta name="description" content="Build and simulate quantum circuits with the Enhanced Quantum Circuit Simulator - featuring advanced visualizations, educational insights, and comprehensive analysis.">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/quantum-visualizations.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Enhanced CSS with new features */
        .circuit-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            color: #ffffff;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .circuit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Enhanced gate grid with more gates */
        .circuit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .gate-button {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.8rem 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            font-size: 0.85rem;
            color: white;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .gate-button:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }
        
        /* BB84 specific gates styling */
        .bb84-gate {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(238, 90, 111, 0.2) 100%);
            border-color: rgba(255, 107, 107, 0.4);
        }
        
        .bb84-gate:hover {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.4) 0%, rgba(238, 90, 111, 0.4) 100%);
            border-color: rgba(255, 107, 107, 0.6);
        }
        
        /* Enhanced insights display */
        .educational-insights {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            backdrop-filter: blur(10px);
        }
        
        .insights-section {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .insights-section h5 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .quantum-phenomena {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .phenomenon-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }
        
        .phenomenon-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }
        
        .adaptive-challenges {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .challenge-item {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #FFC107;
        }
        
        /* Advanced metrics display */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 0.5rem 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #b0b0b0;
        }
        
        /* Enhanced circuit builder */
        .circuit-builder {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .advanced-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: #e0e0e0;
            font-size: 0.9rem;
        }
        
        .control-group input, .control-group select {
            width: 100%;
            padding: 0.8rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        /* Enhanced results display */
        .results-display {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
        }
        
        .visualization-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Notification system */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            max-width: 350px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-success {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }
        
        .notification-error {
            background: linear-gradient(135deg, #F44336, #E91E63);
        }
        
        .notification-info {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
        }
        
        /* Loading states */
        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Enhanced button styles */
        .btn-simulate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .btn-simulate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-simulate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Section styling */
        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-description {
            font-size: 1.2rem;
            color: #b0b0b0;
            margin-bottom: 3rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="logo"><a href="../index.html">QuantumCrypto Tutorial</a></h1>
                <ul class="nav-menu">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="quantum-intro.html">Quantum Basics</a></li>
                    <li><a href="qubits-tutorial.html">Qubits</a></li>
                    <li><a href="quantum-gates.html">Gates</a></li>
                    <li><a href="quantum-circuits.html" class="active">Enhanced Circuits</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="lesson-content">
        <div class="container">
            <div class="lesson-header">
                <h1>Enhanced Quantum Circuit Builder</h1>
                <p class="lesson-subtitle">
                    Experience the most advanced quantum circuit simulator with comprehensive educational insights 
                    and enhanced analysis features powered by the Enhanced Quantum Circuit Simulator.
                </p>
            </div>

            <div class="lesson-navigation">
                <div class="nav-item">
                    <a href="quantum-intro.html">
                        <span class="nav-number">01</span>
                        <span class="nav-title">Introduction</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="qubits-tutorial.html">
                        <span class="nav-number">02</span>
                        <span class="nav-title">Qubits</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="quantum-gates.html">
                        <span class="nav-number">03</span>
                        <span class="nav-title">Gates</span>
                    </a>
                </div>
                <div class="nav-item current">
                    <span class="nav-number">04</span>
                    <span class="nav-title">Enhanced Circuits</span>
                </div>
            </div>

            <article class="lesson-article">
                <!-- Advanced Circuit Builder Section -->
                <section class="content-section">
                    <h2 class="section-title">Advanced Circuit Builder</h2>
                    <p class="section-description">
                        Build quantum circuits using our enhanced simulator that supports all quantum gates
                        and provides comprehensive educational insights and analysis.
                    </p>
                    
                    <div class="circuit-card">
                        <h3>🎛️ Enhanced Circuit Controls</h3>
                        <div class="advanced-controls">
                            <div class="control-group">
                                <label for="enhanced-qubits">Number of Qubits:</label>
                                <select id="enhanced-qubits">
                                    <option value="1">1 Qubit</option>
                                    <option value="2" selected>2 Qubits</option>
                                    <option value="3">3 Qubits</option>
                                    <option value="4">4 Qubits</option>
                                    <option value="5">5 Qubits</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="enhanced-shots">Measurement Shots:</label>
                                <input type="number" id="enhanced-shots" value="1024" min="100" max="10000">
                            </div>
                        </div>
                        <button class="btn-simulate" onclick="initializeEnhancedCircuit()">Initialize Enhanced Circuit</button>
                        
                        <!-- Enhanced Gate Library -->
                        <div class="circuit-builder">
                            <h4>🚀 Complete Quantum Gate Library</h4>
                            <div class="circuit-grid">
                                <!-- Basic Single-Qubit Gates -->
                                <div class="gate-button" onclick="addEnhancedGate('I')" title="Identity Gate">
                                    <div>I</div>
                                    <small>Identity</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('X')" title="Pauli-X (NOT) Gate">
                                    <div>X</div>
                                    <small>NOT</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('Y')" title="Pauli-Y Gate">
                                    <div>Y</div>
                                    <small>Pauli-Y</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('Z')" title="Pauli-Z Gate">
                                    <div>Z</div>
                                    <small>Phase Flip</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('H')" title="Hadamard Gate">
                                    <div>H</div>
                                    <small>Superposition</small>
                                </div>
                                
                                <!-- Phase Gates -->
                                <div class="gate-button" onclick="addEnhancedGate('S')" title="S Phase Gate">
                                    <div>S</div>
                                    <small>Phase π/2</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('T')" title="T Gate">
                                    <div>T</div>
                                    <small>Phase π/4</small>
                                </div>
                                
                                <!-- Rotation Gates -->
                                <div class="gate-button" onclick="addEnhancedGate('RX')" title="X-Rotation Gate">
                                    <div>RX</div>
                                    <small>X-Rotate</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('RY')" title="Y-Rotation Gate">
                                    <div>RY</div>
                                    <small>Y-Rotate</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('RZ')" title="Z-Rotation Gate">
                                    <div>RZ</div>
                                    <small>Z-Rotate</small>
                                </div>
                                
                                <!-- Two-Qubit Gates -->
                                <div class="gate-button" onclick="addEnhancedGate('CNOT')" title="Controlled-NOT Gate">
                                    <div>CNOT</div>
                                    <small>Entangle</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('CZ')" title="Controlled-Z Gate">
                                    <div>CZ</div>
                                    <small>Ctrl-Z</small>
                                </div>
                                <div class="gate-button" onclick="addEnhancedGate('SWAP')" title="SWAP Gate">
                                    <div>SWAP</div>
                                    <small>Exchange</small>
                                </div>
                                
                                <!-- BB84 Preparation Gates -->
                                <div class="gate-button bb84-gate" onclick="addEnhancedGate('PREPARE_0')" title="BB84: Prepare |0⟩">
                                    <div>|0⟩</div>
                                    <small>BB84-0</small>
                                </div>
                                <div class="gate-button bb84-gate" onclick="addEnhancedGate('PREPARE_1')" title="BB84: Prepare |1⟩">
                                    <div>|1⟩</div>
                                    <small>BB84-1</small>
                                </div>
                                <div class="gate-button bb84-gate" onclick="addEnhancedGate('PREPARE_PLUS')" title="BB84: Prepare |+⟩">
                                    <div>|+⟩</div>
                                    <small>BB84-+</small>
                                </div>
                                <div class="gate-button bb84-gate" onclick="addEnhancedGate('PREPARE_MINUS')" title="BB84: Prepare |−⟩">
                                    <div>|−⟩</div>
                                    <small>BB84-−</small>
                                </div>
                            </div>
                            
                            <!-- Enhanced Circuit Display -->
                            <div class="results-display" id="enhanced-circuit-display">
                                <p>🔧 Click "Initialize Enhanced Circuit" to start building with the complete gate library...</p>
                            </div>
                            
                            <!-- Advanced Control Panel -->
                            <div class="advanced-controls">
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="simulateEnhancedCircuit()" id="enhanced-simulate-btn" disabled>
                                        <span id="enhanced-simulate-text">🚀 Run Enhanced Simulation</span>
                                    </button>
                                </div>
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="clearEnhancedCircuit()">🧹 Clear Circuit</button>
                                </div>
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="loadEnhancedPreset('bell')">🔗 Bell State</button>
                                </div>
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="loadEnhancedPreset('ghz')">🌐 GHZ State</button>
                                </div>
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="loadEnhancedPreset('grover')">🔍 Grover's</button>
                                </div>
                                <div class="control-group">
                                    <button class="btn-simulate" onclick="loadEnhancedPreset('deutsch_jozsa')">⚡ Deutsch-Jozsa</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Enhanced Results Section -->
                <section class="content-section">
                    <h2 class="section-title">📊 Comprehensive Analysis Results</h2>
                    <p class="section-description">
                        Experience detailed circuit analysis with enhanced metrics, educational insights, 
                        and adaptive learning recommendations from our advanced simulator.
                    </p>
                    
                    <div class="circuit-card">
                        <h3>🎯 Enhanced Simulation Results</h3>
                        <div class="results-display" id="enhanced-results">
                            <p>🔬 Enhanced simulation results with comprehensive analysis will appear here...</p>
                        </div>
                    </div>

                    <!-- Advanced Metrics Display -->
                    <div class="circuit-card">
                        <h3>📈 Advanced Quantum Metrics</h3>
                        <div class="metrics-grid" id="enhanced-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="circuit-depth">-</div>
                                <div class="metric-label">Circuit Depth</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="gate-count">-</div>
                                <div class="metric-label">Total Gates</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="entropy-measure">-</div>
                                <div class="metric-label">Shannon Entropy</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="entanglement-strength">-</div>
                                <div class="metric-label">Entanglement</div>
                            </div>
                        </div>
                    </div>

                    <!-- Educational Insights Panel -->
                    <div class="circuit-card">
                        <h3>🎓 Enhanced Educational Insights</h3>
                        <div class="educational-insights" id="educational-insights">
                            <p>🧠 Comprehensive educational analysis will appear here after simulation...</p>
                        </div>
                    </div>

                    <!-- Advanced Visualizations -->
                    <div class="circuit-card">
                        <h3>🎨 Advanced Visualizations</h3>
                        <div id="advanced-visualizations">
                            <p>🖼️ Enhanced visualizations including circuit diagrams and histogram charts will appear here...</p>
                        </div>
                    </div>
                </section>
            </article>

            <div class="lesson-footer">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%"></div>
                </div>
                <div class="lesson-actions">
                    <a href="quantum-gates.html" class="btn btn-outline">← Back to Gates</a>
                    <a href="../bb84-protocol/bb84-tutorial.html" class="btn btn-primary">Next: BB84 Protocol →</a>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/main.js"></script>
    <script>
        // Enhanced Quantum Circuit Application with Simplified Controls
        class EnhancedQuantumCircuitApp {
            constructor() {
                this.currentCircuit = [];
                this.circuitQubits = 2;
                this.circuitShots = 1024;
                this.circuitInitialized = false;
                this.simulationInProgress = false;
                
                this.initializeEventListeners();
                this.showNotification('🎉 Enhanced Quantum Circuit Simulator loaded!', 'info');
            }

            initializeEventListeners() {
                // Simplified control listeners (only qubits and shots)
                document.getElementById('enhanced-qubits').addEventListener('change', (e) => {
                    this.circuitQubits = parseInt(e.target.value);
                    if (this.circuitInitialized) {
                        this.updateEnhancedCircuitDisplay();
                    }
                });
                
                document.getElementById('enhanced-shots').addEventListener('change', (e) => {
                    this.circuitShots = Math.min(10000, Math.max(100, parseInt(e.target.value)));
                    e.target.value = this.circuitShots;
                });
            }

            initializeEnhancedCircuit() {
                this.circuitQubits = parseInt(document.getElementById('enhanced-qubits').value);
                this.circuitShots = parseInt(document.getElementById('enhanced-shots').value);
                
                this.currentCircuit = [];
                this.circuitInitialized = true;
                
                this.enableGateButtons();
                document.getElementById('enhanced-simulate-btn').disabled = false;
                
                this.updateEnhancedCircuitDisplay();
                this.showNotification(`🎯 Enhanced Circuit initialized with ${this.circuitQubits} qubits!`, 'success');
            }

            enableGateButtons() {
                document.querySelectorAll('.gate-button').forEach(btn => {
                    btn.style.opacity = '1';
                    btn.style.pointerEvents = 'auto';
                    btn.disabled = false;
                });
            }

            addEnhancedGate(gateType) {
                if (!this.circuitInitialized) {
                    this.initializeEnhancedCircuit();
                }
                
                // Enhanced gate validation with full simulator support
                if (['CNOT', 'CZ', 'SWAP'].includes(gateType) && this.circuitQubits < 2) {
                    this.showNotification(`❌ ${gateType} gate requires at least 2 qubits!`, 'error');
                    return;
                }
                
                const gateSpec = this.createEnhancedGateSpecification(gateType);
                this.currentCircuit.push(gateSpec);
                
                this.updateEnhancedCircuitDisplay();
                this.showNotification(`✅ ${gateType} gate added with enhanced metadata!`, 'success');
            }

            createEnhancedGateSpecification(gateType) {
                const baseSpec = { type: gateType };
                
                // Enhanced gate specifications matching the simulator
                switch(gateType) {
                    case 'CNOT':
                        return { ...baseSpec, control: 0, target: Math.min(1, this.circuitQubits - 1) };
                    case 'CZ':
                        return { ...baseSpec, control: 0, target: Math.min(1, this.circuitQubits - 1) };
                    case 'SWAP':
                        return { ...baseSpec, qubit1: 0, qubit2: Math.min(1, this.circuitQubits - 1) };
                    case 'RX':
                    case 'RY':
                    case 'RZ':
                        // Default to π/2 rotation as in the simulator
                        return { ...baseSpec, qubit: 0, angle: Math.PI / 2 };
                    case 'PREPARE_0':
                    case 'PREPARE_1':
                    case 'PREPARE_PLUS':
                    case 'PREPARE_MINUS':
                        // BB84 preparation gates
                        return { ...baseSpec, qubit: 0 };
                    default:
                        return { ...baseSpec, qubit: 0 };
                }
            }

            updateEnhancedCircuitDisplay() {
                const display = document.getElementById('enhanced-circuit-display');
                
                if (!this.circuitInitialized) {
                    display.innerHTML = `
                        <div style="color: #ff6b6b; margin: 1rem 0;">⚠️ Circuit Not Initialized</div>
                        <p>Click "Initialize Enhanced Circuit" to start building with full gate library...</p>
                    `;
                    return;
                }
                
                if (this.currentCircuit.length === 0) {
                    display.innerHTML = `
                        <div style="color: #4CAF50; margin: 1rem 0;">✅ Enhanced Circuit Ready</div>
                        <p><strong>📊 Configuration:</strong> ${this.circuitQubits} qubits | ${this.circuitShots} shots</p>
                        <p>🎯 Add gates from the complete library above to build your quantum circuit.</p>
                    `;
                } else {
                    const gateNames = this.currentCircuit.map(g => g.type);
                    const complexity = this.assessComplexity();
                    
                    display.innerHTML = `
                        <div style="color: #667eea; margin: 1rem 0;">🔧 Enhanced Circuit Built (${complexity} Complexity)</div>
                        <p><strong>🎯 Gates:</strong> ${gateNames.join(' → ')}</p>
                        <p><strong>📏 Circuit Length:</strong> ${this.currentCircuit.length} gates</p>
                        <p><strong>🧬 Gate Variety:</strong> ${new Set(gateNames).size} different types</p>
                        <p><strong>📊 Configuration:</strong> ${this.circuitQubits} qubits | ${this.circuitShots} shots</p>
                    `;
                }
            }

            assessComplexity() {
                const gateCount = this.currentCircuit.length;
                const twoQubitGates = this.currentCircuit.filter(g => 
                    ['CNOT', 'CZ', 'SWAP'].includes(g.type)
                ).length;
                
                if (gateCount > 10 || twoQubitGates > 3) return 'High';
                if (gateCount > 5 || twoQubitGates > 1) return 'Medium';
                return 'Low';
            }

            async simulateEnhancedCircuit() {
                if (!this.circuitInitialized || this.currentCircuit.length === 0) {
                    this.showNotification('⚠️ Please add gates to the circuit first!', 'error');
                    return;
                }
                
                if (this.simulationInProgress) {
                    this.showNotification('⏳ Enhanced simulation already in progress...', 'error');
                    return;
                }
                
                this.simulationInProgress = true;
                this.setEnhancedSimulationUI(true);
                
                try {
                    // Simplified request body (removed user context parameters)
                    const requestBody = {
                        num_qubits: this.circuitQubits,
                        gates: this.currentCircuit,
                        shots: this.circuitShots,
                        include_statevector: false,    // Disabled as not implemented
                        include_density_matrix: false,
                        include_bloch_sphere: false,   // Disabled as not implemented
                        user_context: {
                            interests: ['entanglement', 'cryptography', 'algorithms']
                        }
                    };
                    
                    const response = await fetch('/api/simulate-circuit', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.displayEnhancedResults(result);
                        this.showNotification('🎉 Enhanced simulation completed successfully!', 'success');
                    } else {
                        throw new Error(result.error || 'Simulation failed');
                    }
                    
                } catch (error) {
                    console.error('Enhanced simulation error:', error);
                    this.displayEnhancedError(error.message);
                    this.showNotification('❌ Enhanced simulation failed: ' + error.message, 'error');
                } finally {
                    this.simulationInProgress = false;
                    this.setEnhancedSimulationUI(false);
                }
            }

            setEnhancedSimulationUI(simulating) {
                const simulateBtn = document.getElementById('enhanced-simulate-btn');
                const simulateText = document.getElementById('enhanced-simulate-text');
                
                if (simulating) {
                    simulateText.innerHTML = '<span class="loading-indicator"></span> Running Enhanced Simulation...';
                    simulateBtn.disabled = true;
                } else {
                    simulateText.textContent = '🚀 Run Enhanced Simulation';
                    simulateBtn.disabled = false;
                }
            }

            displayEnhancedResults(result) {
                // Enhanced results display with comprehensive analysis
                this.displayBasicEnhancedResults(result);
                this.displayAdvancedMetrics(result);
                this.displayEducationalInsights(result);
                this.displayAdvancedVisualizations(result);
            }

            displayBasicEnhancedResults(result) {
                const resultsDiv = document.getElementById('enhanced-results');
                const gateNames = this.currentCircuit.map(g => g.type);
                
                let html = `
                    <div style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; padding: 1rem; border-radius: 12px; margin: 1rem 0;">
                        <h4>🔬 Enhanced Simulation Results</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
                            <div><strong>🎯 Circuit:</strong> ${gateNames.join(' → ')}</div>
                            <div><strong>📊 Qubits:</strong> ${this.circuitQubits}</div>
                            <div><strong>🎲 Shots:</strong> ${this.circuitShots}</div>
                            <div><strong>📏 Depth:</strong> ${result.simulation_metadata?.circuit_depth || 'N/A'}</div>
                            <div><strong>🚪 Gates:</strong> ${result.simulation_metadata?.gate_count || 'N/A'}</div>
                            <div><strong>⚡ Backend:</strong> ${result.simulation_metadata?.backend || 'Enhanced Qiskit'}</div>
                        </div>
                    </div>
                `;
                
                if (result.counts) {
                    const totalMeasurements = Object.values(result.counts).reduce((a, b) => a + b, 0);
                    html += '<h5>📊 Enhanced Measurement Analysis:</h5>';
                    html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1rem 0;">';
                    
                    Object.entries(result.counts).forEach(([state, count]) => {
                        const probability = (count / totalMeasurements * 100).toFixed(1);
                        html += `
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1);">
                                |${state}⟩: ${count}<br>
                                <small style="color: #b0b0b0;">${probability}%</small>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                }
                
                resultsDiv.innerHTML = html;
            }

            displayAdvancedMetrics(result) {
                if (!result.metrics) return;
                
                const metrics = result.metrics;
                document.getElementById('circuit-depth').textContent = metrics.circuit_depth || '-';
                document.getElementById('gate-count').textContent = metrics.total_gates || '-';
                document.getElementById('entropy-measure').textContent = 
                    metrics.measurement_entropy ? metrics.measurement_entropy.toFixed(3) : '-';
                
                // Enhanced entanglement display
                let entanglementText = '-';
                if (metrics.entanglement_measures?.entanglement_entropy) {
                    entanglementText = `${metrics.entanglement_measures.entanglement_entropy.toFixed(3)} bits`;
                } else if (this.currentCircuit.some(g => ['CNOT', 'CZ', 'SWAP'].includes(g.type))) {
                    entanglementText = 'Detected';
                }
                document.getElementById('entanglement-strength').textContent = entanglementText;
            }

            displayEducationalInsights(result) {
                const insightsDiv = document.getElementById('educational-insights');
                
                if (!result.insights) {
                    insightsDiv.innerHTML = '<p>🧠 Educational insights not available.</p>';
                    return;
                }
                
                const insights = result.insights;
                let html = '<div style="display: grid; gap: 1.5rem;">';
                
                // Gate-by-gate insights
                if (insights.gate_by_gate_insights) {
                    html += `
                        <div class="insights-section">
                            <h5>🔍 Gate-by-Gate Analysis:</h5>
                            <div style="display: grid; gap: 1rem;">
                    `;
                    insights.gate_by_gate_insights.forEach((gate_insight, i) => {
                        if (gate_insight.physics_explanation) {
                            html += `
                                <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <strong>Gate ${i + 1} (${gate_insight.gate}):</strong><br>
                                    <small>${gate_insight.physics_explanation}</small>
                                    ${gate_insight.visual_analogy ? `<br><em>💡 ${gate_insight.visual_analogy}</em>` : ''}
                                </div>
                            `;
                        }
                    });
                    html += '</div></div>';
                }
                
                // Quantum phenomena detection
                if (insights.quantum_phenomena) {
                    html += `
                        <div class="insights-section">
                            <h5>🌊 Quantum Phenomena Detected:</h5>
                            <div class="quantum-phenomena">
                    `;
                    Object.entries(insights.quantum_phenomena).forEach(([phenomenon, details]) => {
                        if (details.detected) {
                            html += `
                                <div class="phenomenon-card">
                                    <h6 style="color: #667eea; margin-bottom: 0.5rem;">✅ ${phenomenon.toUpperCase()}</h6>
                                    <p style="font-size: 0.9rem; margin: 0.5rem 0;">${details.explanation}</p>
                                    ${details.applications ? `<small><strong>Applications:</strong> ${details.applications.slice(0, 2).join(', ')}</small>` : ''}
                                </div>
                            `;
                        }
                    });
                    html += '</div></div>';
                }
                
                // Circuit story
                if (insights.circuit_story) {
                    html += `
                        <div class="insights-section">
                            <h5>📖 Circuit Story:</h5>
                            <p>${insights.circuit_story.step_by_step}</p>
                            <p><em>${insights.circuit_story.physics_summary}</em></p>
                        </div>
                    `;
                }
                
                // Adaptive challenges
                if (insights.adaptive_challenges && insights.adaptive_challenges.length > 0) {
                    html += `
                        <div class="adaptive-challenges">
                            <h5 style="color: #FFC107;">🎯 Suggested Challenges:</h5>
                    `;
                    insights.adaptive_challenges.forEach(challenge => {
                        html += `
                            <div class="challenge-item">
                                <strong>${challenge.title}:</strong> ${challenge.description}<br>
                                <small>📝 Task: ${challenge.task}</small>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                // Real-world applications
                if (insights.real_world_applications && insights.real_world_applications.length > 0) {
                    html += `
                        <div class="insights-section">
                            <h5>🌍 Real-World Applications:</h5>
                    `;
                    insights.real_world_applications.forEach(app => {
                        html += `
                            <div style="margin: 1rem 0; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                                <strong>${app.concept}:</strong> ${app.application}<br>
                                <small>${app.description}</small>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                html += '</div>';
                insightsDiv.innerHTML = html;
            }

            displayAdvancedVisualizations(result) {
                const vizDiv = document.getElementById('advanced-visualizations');
                
                if (!result.visualizations) {
                    vizDiv.innerHTML = '<p>🖼️ Advanced visualizations not available.</p>';
                    return;
                }
                
                const visualizations = result.visualizations;
                let html = '<div style="display: grid; gap: 2rem;">';
                
                // Display available visualizations (only implemented ones)
                if (visualizations.circuit_diagram) {
                    html += this.createVisualizationSection('🔧 Enhanced Circuit Diagram', visualizations.circuit_diagram);
                }
                
                if (visualizations.histogram) {
                    html += this.createVisualizationSection('📊 Enhanced Measurement Histogram', visualizations.histogram);
                }
                
                if (visualizations.probability_chart) {
                    html += this.createVisualizationSection('📊 Probability Distribution Chart', visualizations.probability_chart);
                }
                
                html += '</div>';
                vizDiv.innerHTML = html;
            }

            createVisualizationSection(title, imageData) {
                return `
                    <div class="visualization-container">
                        <h6>${title}</h6>
                        <img src="data:image/png;base64,${imageData}" 
                             alt="${title}" 
                             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    </div>
                `;
            }

            displayEnhancedError(message) {
                document.getElementById('enhanced-results').innerHTML = `
                    <div style="background: linear-gradient(135deg, #F44336, #E91E63); color: white; padding: 1.5rem; border-radius: 12px; margin: 1rem 0;">
                        <h4>❌ Enhanced Simulation Error</h4>
                        <p>${message}</p>
                        <p><strong>Possible solutions:</strong></p>
                        <ul>
                            <li>Check that the Enhanced Quantum Circuit Simulator backend is running</li>
                            <li>Verify the /api/simulate-circuit endpoint is properly configured</li>
                            <li>Ensure all required dependencies (Qiskit, NumPy, Matplotlib) are installed</li>
                            <li>Check server logs for detailed error information</li>
                        </ul>
                    </div>
                `;
            }

            clearEnhancedCircuit() {
                this.currentCircuit = [];
                this.updateEnhancedCircuitDisplay();
                
                // Clear all result sections
                document.getElementById('enhanced-results').innerHTML = 
                    '<p>🧹 Enhanced circuit cleared. Results will appear here after simulation.</p>';
                document.getElementById('educational-insights').innerHTML = 
                    '<p>🧠 Educational insights will appear here after simulation.</p>';
                document.getElementById('advanced-visualizations').innerHTML = 
                    '<p>🖼️ Advanced visualizations will appear here after simulation.</p>';
                
                this.showNotification('🧹 Enhanced circuit cleared!', 'info');
            }

            async loadEnhancedPreset(preset) {
                try {
                    this.circuitInitialized = true;
                    this.enableGateButtons();
                    document.getElementById('enhanced-simulate-btn').disabled = false;
                    
                    if (preset === 'bell') {
                        this.circuitQubits = 2;
                        this.currentCircuit = [
                            { type: 'H', qubit: 0 },
                            { type: 'CNOT', control: 0, target: 1 }
                        ];
                        document.getElementById('enhanced-qubits').value = '2';
                        this.showNotification('🔗 Enhanced Bell state circuit loaded!', 'success');
                    } else if (preset === 'ghz') {
                        this.circuitQubits = 3;
                        this.currentCircuit = [
                            { type: 'H', qubit: 0 },
                            { type: 'CNOT', control: 0, target: 1 },
                            { type: 'CNOT', control: 0, target: 2 }
                        ];
                        document.getElementById('enhanced-qubits').value = '3';
                        this.showNotification('🌐 Enhanced GHZ state circuit loaded!', 'success');
                    } else if (preset === 'grover') {
                        this.circuitQubits = 2;
                        this.currentCircuit = [
                            { type: 'H', qubit: 0 },
                            { type: 'H', qubit: 1 },
                            { type: 'CZ', control: 0, target: 1 },
                            { type: 'H', qubit: 0 },
                            { type: 'H', qubit: 1 }
                        ];
                        document.getElementById('enhanced-qubits').value = '2';
                        this.showNotification('🔍 Enhanced Grover search circuit loaded!', 'success');
                    } else if (preset === 'deutsch_jozsa') {
                        this.circuitQubits = 3;
                        this.currentCircuit = [
                            { type: 'X', qubit: 2 },
                            { type: 'H', qubit: 0 },
                            { type: 'H', qubit: 1 },
                            { type: 'H', qubit: 2 },
                            { type: 'CNOT', control: 0, target: 2 },
                            { type: 'H', qubit: 0 },
                            { type: 'H', qubit: 1 }
                        ];
                        document.getElementById('enhanced-qubits').value = '3';
                        this.showNotification('⚡ Enhanced Deutsch-Jozsa algorithm loaded!', 'success');
                    }
                    
                    this.updateEnhancedCircuitDisplay();
                    await this.simulateEnhancedCircuit();
                    
                } catch (error) {
                    this.showNotification('❌ Failed to load enhanced preset: ' + error.message, 'error');
                }
            }

            showNotification(message, type = 'info') {
                // Remove existing notifications
                document.querySelectorAll('.notification').forEach(n => n.remove());
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }
        }

        // Initialize the Enhanced Application
        const enhancedQuantumApp = new EnhancedQuantumCircuitApp();

        // Global functions for HTML onclick events
        function initializeEnhancedCircuit() { enhancedQuantumApp.initializeEnhancedCircuit(); }
        function addEnhancedGate(gateType) { enhancedQuantumApp.addEnhancedGate(gateType); }
        function simulateEnhancedCircuit() { enhancedQuantumApp.simulateEnhancedCircuit(); }
        function clearEnhancedCircuit() { enhancedQuantumApp.clearEnhancedCircuit(); }
        function loadEnhancedPreset(preset) { enhancedQuantumApp.loadEnhancedPreset(preset); }

        // Initialize display on page load
        document.addEventListener('DOMContentLoaded', function() {
            enhancedQuantumApp.updateEnhancedCircuitDisplay();
            console.log('Enhanced Quantum Circuits tutorial loaded with simplified controls');
        });
    </script>
</body>
</html>
